<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Quiet Routes Astana ‚Äî Ras2</title>
<meta name="description" content="–¢–∏—Ö–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã, –º–µ—Å—Ç–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –ê—Å—Ç–∞–Ω–µ (–¥–µ–º–æ SPA —Å —Ö—ç—à-—Ä–æ—É—Ç–µ—Ä–æ–º)." />
<style>
  :root{
    --bg:#f7f5fb; --card:#ffffff; --ink:#1f2430; --muted:#6a7280; --border:#e6e1ff;
    --accent:#6b5ae0; --accent-2:#18a999; --danger:#e03b5a; --soft:#efeaff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Roboto,Arial}
  a{color:var(--accent); text-decoration:none}
  a:hover{text-decoration:underline}
  header{position:sticky; top:0; z-index:1000; background:#fff; border-bottom:1px solid var(--border)}
  nav{max-width:1200px; margin:0 auto; padding:10px 14px; display:flex; flex-wrap:wrap; gap:8px}
  nav a{padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#fff; font-weight:600; font-size:14px}
  nav a.active{background:var(--soft); border-color:#cfc6ff}
  main{max-width:1200px; margin:0 auto; padding:14px}
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:10px}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px; box-shadow:0 1px 2px rgba(20,10,60,.04); margin-bottom:12px}
  h1{font-size:22px; margin:8px 0}
  h2{font-size:18px; margin:8px 0}
  label{font-size:13px; color:var(--muted); display:block; margin-bottom:4px}
  input, select, button, textarea{width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:#fff; font-size:15px}
  textarea{min-height:100px}
  .btn{background:var(--accent); color:#fff; border:none; border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer}
  .btn.secondary{background:#fff; color:var(--accent); border:1px solid var(--border)}
  .btn.ghost{background:transparent; border:1px dashed #cfc6ff; color:#6a7280}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#fff; font-size:12px}
  .pill .dot{width:8px; height:8px; border-radius:50%; background:var(--accent-2)}
  .muted{color:var(--muted); font-size:13px}
  .notice{background:#f8fafc; border:1px solid #e6eef8; border-radius:12px; padding:10px; color:#41566b; font-size:13px}
  .map{position:relative; width:100%; height:340px; background:#e9eef6; border:1px solid #cfd7e6; border-radius:14px; overflow:hidden}
  /* –∫–∞—Ä—Ç–∞ –∏ –µ—ë —Å–ª–æ–∏ ‚Äî –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∫–ª–∏–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ UI */
  .map, .map * { pointer-events: none; }
  .map .legend{position:absolute; right:10px; top:10px; background:#ffffffcc; border:1px solid #e6eef8; border-radius:8px; padding:6px 8px; font-size:12px; pointer-events:auto}
  .map svg{position:absolute; inset:0}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{padding:8px 10px; border:1px solid var(--border); border-radius:999px; font-size:13px; cursor:pointer; background:#fff}
  .chip.active{background:var(--soft); border-color:#cfc6ff}
  .hidden{display:none !important}
  .split{display:grid; grid-template-columns:1.2fr .8fr; gap:10px}
  @media(max-width:900px){ .split{grid-template-columns:1fr} }
  .hero{display:grid; grid-template-columns:1.2fr .8fr; gap:12px}
  @media(max-width:900px){ .hero{grid-template-columns:1fr} }
  .meter{background:#ede9ff; border-radius:10px; overflow:hidden; height:10px}
  .meter>div{height:100%; width:0; background:linear-gradient(90deg,#6b5ae0,#8f7fff)}
  footer{max-width:1200px; margin:20px auto 30px; padding:0 14px; color:var(--muted); font-size:12px}
  .quiet-theme{filter:brightness(.95) saturate(.9)}

  /* –î–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º */
  #view-kids .grid { display:grid; gap:12px; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); }
  #view-kids .row { display:flex; align-items:center; gap:10px; margin:8px 0; }
  #view-kids details { margin:12px 0; }
  #view-kids input, #view-kids select { width:100%; }
  .dino-select { display:flex; gap:16px; flex-wrap:wrap; }
  .dino-select label { display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid #ffd1e3; border-radius:12px; cursor:pointer; }
  .dino-select img { width:44px; height:44px; display:block; }
  .dino-select input { accent-color:#ff4f8a; }
  .kid-actions { display:flex; gap:12px; margin:12px 0; }
  #btnTest, #btnSOS { padding:12px 16px; border:none; border-radius:10px; font-weight:600; }
  #btnTest { background:#ffd1e3; }
  #btnSOS { background:#ff4f8a; color:#fff; }
  #btnSOS.sos { animation:pulse 1.6s infinite; }
  @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.04)} 100%{transform:scale(1)} }
  .kid-cursor { width:40px; height:40px; position:absolute; transform:translate(-50%,-50%); pointer-events:none; animation:bob 1.2s ease-in-out infinite; }
  @keyframes bob { 0%,100%{ transform:translate(-50%,-52%)} 50%{ transform:translate(-50%,-48%)} }
</style>
</head>
<body>

<header>
  <nav id="nav">
    <a href="#/" data-view="home">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</a>
    <a href="#/routes" data-view="routes">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä</a>
    <a href="#/places" data-view="places">–¢–∏—Ö–∏–µ –º–µ—Å—Ç–∞</a>
    <a href="#/planner" data-view="planner">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
    <a href="#/alarm" data-view="alarm">–¢—Ä–µ–≤–æ–≥–∞</a>
    <a href="#/volunteer" data-view="volunteer">–í–æ–ª–æ–Ω—Ç—ë—Ä—ã</a>
    <a href="#/crowd" data-view="crowd">–ö—Ä–∞—É–¥—Å–æ—Ä—Å–∏–Ω–≥</a>
    <a href="#/about" data-view="about">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
    <a href="#/kids" data-view="kids">–î–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º</a>
  </nav>
</header>

<!-- –î–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º -->
<section id="view-kids" class="hidden">
  <h2>–î–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º</h2>
  <label class="row">
    <input type="checkbox" id="kidModeToggle">
    <span>–í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è)</span>
  </label>

  <details>
    <summary>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π</summary>
    <div class="grid">
      <label>–°–ø–æ—Å–æ–±:
        <select id="notifyMethod">
          <option value="telegram">Telegram Bot</option>
          <option value="webhook">–ú–æ–π Webhook URL</option>
        </select>
      </label>

      <div id="telegramBlock">
        <label>BOT_TOKEN
          <input type="password" id="tgToken" placeholder="123456:ABC-DEF...">
        </label>
        <label>CHAT_ID
          <input type="text" id="tgChat" placeholder="–ù–∞–ø—Ä. 123456789">
        </label>
      </div>

      <div id="webhookBlock" class="hidden">
        <label>WEBHOOK_URL
          <input type="url" id="webhookUrl" placeholder="https://my-server.example/hook">
        </label>
      </div>

      <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–∫.)
        <input type="number" id="sendInterval" min="10" step="5" value="60">
      </label>
    </div>
  </details>

  <details>
    <summary>–î–∏–Ω–æ–∑–∞–≤—Ä –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–µ–ª–∫–∏</summary>
    <div class="dino-select">
      <label>
        <input type="radio" name="dino" value="rex" checked>
        <img src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M8 40h20l6 6 6-6h16v8H8z' fill='%23ff4f8a'/><circle cx='24' cy='28' r='10' fill='%23ff82ab'/><circle cx='28' cy='26' r='2' fill='%23000'/></svg>" alt="Rex">
        <span>–†–µ–∫—Å</span>
      </label>
      <label>
        <input type="radio" name="dino" value="stego">
        <img src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M6 42h24l4 4 4-4h20v6H6z' fill='%23ff4f8a'/><path d='M12 32l6-6 6 6 6-6 6 6' stroke='%23ff82ab' stroke-width='6' fill='none'/></svg>" alt="Stego">
        <span>–°—Ç–µ–≥–æ</span>
      </label>
      <label>
        <input type="radio" name="dino" value="bronto">
        <img src="data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M10 40h22c8 0 10-8 18-8h4v10H10z' fill='%23ff4f8a'/><path d='M40 22c6 0 6 8 6 12' stroke='%23ff82ab' stroke-width='6' fill='none'/></svg>" alt="Bronto">
        <span>–ë—Ä–æ–Ω—Ç–æ</span>
      </label>
    </div>
  </details>

  <div class="kid-actions">
    <button id="btnTest">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
    <button id="btnSOS" class="sos">SOS</button>
  </div>

  <p class="hint">–°—Ç–∞—Ç—É—Å: <span id="kidStatus">–≤—ã–∫–ª—é—á–µ–Ω–æ</span></p>
</section>
  
<main>
  <!-- HOME -->
  <section id="view-home" class="view">
    <div class="hero">
      <div class="card">
        <div class="row" style="align-items:center">
          <h1 style="margin:0">–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π –∏ —Ç–∏—Ö–∏–π –ø—É—Ç—å</h1>
          <span class="pill"><span class="dot"></span> –ê—Å—Ç–∞–Ω–∞</span>
          <button class="btn secondary" id="toggleQuiet" style="margin-left:auto">–¢–∏—Ö–∞—è —Ç–µ–º–∞</button>
        </div>
        <p>Quiet Routes ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–µ—à–µ—Ö–æ–¥–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ <strong>–∏–∑–±–µ–≥–∞—é—Ç —à—É–º–Ω—ã—Ö/–º–Ω–æ–≥–æ–ª—é–¥–Ω—ã—Ö/—è—Ä–∫–∏—Ö</strong> –∑–æ–Ω –∏ –ø–æ–¥–±–∏—Ä–∞—é—Ç <strong>—Ç–∏—Ö–∏–µ –º–µ—Å—Ç–∞</strong>. –°–¥–µ–ª–∞–Ω–æ –¥–ª—è –ª—é–¥–µ–π —Å –†–ê–° –∏ –≤—ã—Å–æ–∫–æ–π —Å–µ–Ω—Å–æ—Ä–Ω–æ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é. –°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ—é –¥–æ–æ—Ä–æ–≥—É —Å–ø–æ–∫–æ–π–Ω–æ–π –∏ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π.</p>
        <div class="row">
          <a class="btn" href="#/routes">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</a>
          <a class="btn secondary" href="#/places">–¢–∏—Ö–∏–µ –º–µ—Å—Ç–∞</a>
        </div>
      </div>
      <div class="card">
        <div class="map" aria-label="–ö–∞—Ä—Ç–∞ –ê—Å—Ç–∞–Ω—ã (–º–∞–∫–µ—Ç)">
          <div class="legend">–°–∏–Ω–∏–µ ‚Äî —Ç–∏—Ö–æ ¬∑ –ö—Ä–∞—Å–Ω—ã–µ ‚Äî —à—É–º–Ω–æ ¬∑ –ñ—ë–ª—Ç—ã–µ ‚Äî —ç–∫—Ä–∞–Ω—ã</div>
          <svg viewBox="0 0 600 340" preserveAspectRatio="none">
            <g fill="#e6edf7" stroke="#cfd7e6"><rect x="10" y="10" width="580" height="320" rx="16"/></g>
            <path d="M0,200 C150,210 250,180 600,210" stroke="#9ed0ff" stroke-width="14" fill="none" opacity=".8"/>
            <g fill="#e03b5a"><circle cx="200" cy="100" r="36" opacity=".18"/><circle cx="460" cy="120" r="40" opacity=".18"/></g>
            <g fill="#ffd54f"><rect x="370" y="150" width="60" height="26" opacity=".2"/></g>
            <g stroke="#6b5ae0" stroke-width="4" fill="none">
              <path d="M80,300 C180,260 280,240 380,220 460,200 520,190 560,180"/>
              <path d="M120,260 C200,240 260,220 330,210" stroke-dasharray="6 6"/>
            </g>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <!-- ROUTES -->
  <section id="view-routes" class="view hidden">
    <div class="split">
      <div class="card">
        <h2>–ú–∞—Ä—à—Ä—É—Ç A ‚Üí B (—Ç–∏—Ö–∏–π)</h2>
        <div class="row">
          <div style="flex:1"><label>–û—Ç–∫—É–¥–∞</label><input id="from" value="—É–ª. –ú–∞–Ω–∞—Å–∞ 17"></div>
          <div style="flex:1"><label>–ö—É–¥–∞</label><input id="to" value="–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ9"></div>
        </div>
        <div class="chips" style="margin-top:6px">
          <div class="chip active" data-k="noise">—á—É–≤—Å—Ç–≤. –∫ —à—É–º—É</div>
          <div class="chip active" data-k="crowd">–∫ —Ç–æ–ª–ø–µ</div>
          <div class="chip" data-k="light">–∫ —è—Ä–∫–æ–º—É —Å–≤–µ—Ç—É</div>
          <div class="chip" data-k="cross">–∫ –∫—Ä—É–ø–Ω—ã–º –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–∫–∞–º</div>
          <div class="chip active" data-k="parks">–ø–∞—Ä–∫–∏</div>
          <div class="chip active" data-k="yards">–¥–≤–æ—Ä—ã</div>
          <div class="chip" data-k="paths">–ø–µ—à–µ—Ö–æ–¥–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏</div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="build">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç–∏—Ö–∏–π –º–∞—Ä—à—Ä—É—Ç</button>
          <button class="btn secondary" id="alt">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞</button>
          <button class="btn secondary" id="exportRoute">–≠–∫—Å–ø–æ—Ä—Ç .txt</button>
          <button class="btn" id="startNav">–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é</button>
        </div>
        <div class="map" style="margin-top:10px">
          <div class="legend">–¢–∏—Ö–∏–µ ‚Äî —Å–ø–ª–æ—à–Ω–∞—è ¬∑ –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ ‚Äî –ø—É–Ω–∫—Ç–∏—Ä ¬∑ –ò–∑–±–µ–≥–∞—Ç—å ‚Äî –∫—Ä–∞—Å–Ω—ã–π</div>
          <svg viewBox="0 0 600 340" preserveAspectRatio="none">
            <g id="heatLoud" fill="#e03b5a"><circle cx="460" cy="100" r="44" opacity=".18"/><rect x="10" y="320" width="580" height="24" rx="12" opacity=".16"/></g>
            <g id="heatLight" fill="#ffd54f"><rect x="260" y="180" width="70" height="26" opacity=".16"/></g>
            <g id="corridors" stroke="#6b5ae0" stroke-width="4" fill="none">
              <path id="seg1" d="M40,300 C140,260 200,230 300,210" />
              <path id="seg2" d="M300,210 C360,200 420,180 520,160" stroke-dasharray="6 6"/>
              <path id="segBad" d="M10,330 L590,330" stroke="#e03b5a66" stroke-width="6"/>
            </g>
            <g id="routeLine" stroke="#6b5ae0" stroke-width="5" fill="none">
              <path id="rMain" d="M40,300 C140,260 200,230 300,210 360,200 420,180 520,160" />
              <circle cx="40" cy="300" r="6" fill="#18a999"/>
              <circle cx="520" cy="160" r="6" fill="#18a999"/>
            </g>
          </svg>
        </div>
        <div class="notice" style="margin-top:8px">–ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–º–æ: —à—Ç—Ä–∞—Ñ—É–µ—Ç –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏ –∏ ¬´–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏¬ª, –ø–æ–æ—â—Ä—è–µ—Ç –ø–∞—Ä–∫–∏/–¥–≤–æ—Ä—ã; —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —á–∞—Å.</div>
      </div>
      <div class="card">
        <h2>–®–∞–≥–∏</h2>
        <div id="steps" class="grid">
          <div class="card" style="border-style:dashed"><strong>–ß–µ—Ä–µ–∑ –¥–≤–æ—Ä</strong><div class="muted">150 –º ¬∑ –Ω–∏–∑–∫–∏–π —à—É–º</div></div>
          <div class="card" style="border-style:dashed"><strong>–ß–µ—Ä–µ–∑ –ø–∞—Ä–∫</strong><div class="muted">500 –º ¬∑ –∑–µ–ª—ë–Ω–∞—è –∑–æ–Ω–∞</div></div>
          <div class="card" style="border-style:dashed"><strong>–ù–µ–±–æ–ª—å—à–∞—è —É–ª–∏—Ü–∞</strong><div class="muted">300 –º ¬∑ –≤–æ–∑–º–æ–∂–µ–Ω —à—É–º –≤–µ—á–µ—Ä–æ–º</div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- PLACES -->
  <section id="view-places" class="view hidden">
    <div class="split">
      <div class="card">
        <h2>–¢–∏—Ö–∏–µ –º–µ—Å—Ç–∞ (–ê—Å—Ç–∞–Ω–∞)</h2>
        <div class="chips">
          <div class="chip active" data-f="open">–û—Ç–∫—Ä—ã—Ç—ã</div>
          <div class="chip" data-f="music">–ë–µ–∑ –º—É–∑—ã–∫–∏</div>
          <div class="chip" data-f="light">–ú—è–≥–∫–∏–π —Å–≤–µ—Ç</div>
          <div class="chip" data-f="wc">–°–∞–Ω—É–∑–µ–ª</div>
        </div>
        <div id="placeList" class="grid" style="margin-top:8px"></div>
      </div>
      <div class="card">
        <h2>–ö–∞—Ä—Ç–∞</h2>
        <div class="map">
          <div class="legend">–ú–∞—Ä–∫–µ—Ä—ã ‚Äî —Ç–∏—Ö–∏–µ —Ç–æ—á–∫–∏</div>
          <svg viewBox="0 0 600 340" preserveAspectRatio="none">
            <g fill="#e6edf7" stroke="#cfd7e6"><rect x="10" y="10" width="580" height="320" rx="16"/></g>
            <path d="M0,200 C150,210 250,180 600,210" stroke="#9ed0ff" stroke-width="14" fill="none" opacity=".8"/>
            <g id="poiLayer" fill="#18a999" stroke="#fff" stroke-width="2"></g>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <!-- PLANNER -->
  <section id="view-planner" class="view hidden">
    <div class="split">
      <div class="card">
        <h2>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–∏–∑–∏—Ç–∞</h2>
        <div class="row">
          <div><label>–î–∞—Ç–∞</label><input type="date" id="pDate"/></div>
          <div><label>–í—Ä–µ–º—è</label><input type="time" id="pTime" value="11:00"/></div>
        </div>
        <div class="row" style="margin-top:6px">
          <div><label>–¢–æ—á–∫–∞ A</label><input id="pA" value="–î–æ–º (–°–∞—Ä—ã–∞—Ä–∫–∞)"/></div>
          <div><label>–¢–æ—á–∫–∞ B</label><input id="pB" value="–ö–ª–∏–Ω–∏–∫–∞ –Ω–∞ –ö–µ—Ä–µ–π-–ñ–∞–Ω–∏–±–µ–∫ —Ö–∞–Ω–¥–∞—Ä"/></div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="pSuggest">–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ç–∏—Ö–æ–µ –æ–∫–Ω–æ</button>
          <button class="btn secondary" id="pSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn ghost" id="pExport">–≠–∫—Å–ø–æ—Ä—Ç .txt</button>
        </div>
        <div id="pOut" class="muted" style="margin-top:6px">‚Äî</div>
      </div>
      <div class="card">
        <h2>–ß–µ–∫-–ª–∏—Å—Ç</h2>
        <div class="chips">
          <div class="chip active">–ù–∞—É—à–Ω–∏–∫–∏</div>
          <div class="chip active">–°–æ–ª–Ω–µ—á–Ω—ã–µ –æ—á–∫–∏</div>
          <div class="chip">–¢–∏—Ö–∏–π —Ä–µ–∂–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
          <div class="chip">–í–æ–¥–∞/–ø–µ—Ä–µ–∫—É—Å</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ALARM -->
  <section id="view-alarm" class="view hidden">
    <div class="split">
      <div class="card">
        <h2>–¢—Ä–µ–≤–æ–≥–∞</h2>
        <p>–ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é. –í–æ–ª–æ–Ω—Ç—ë—Ä –±—É–¥–µ—Ç —Ä—è–¥–æ–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
        <div class="row">
          <button class="btn" id="aSend" style="background:var(--danger)">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</button>
          <button class="btn" id="aShare">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–∞—Ä—à—Ä—É—Ç–æ–º</button>
        </div>
        <div id="aStatus" class="notice" style="margin-top:8px">–û–∂–∏–¥–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞‚Ä¶</div>
      </div>
      <div class="card">
        <h2>–í–æ–ª–æ–Ω—Ç—ë—Ä –≤ –ø—É—Ç–∏</h2>
        <div class="row" style="justify-content:space-between; align-items:center">
          <div class="pill"><span class="dot"></span> —Å—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ</div>
          <div class="muted">–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ‚Äî</div>
        </div>
        <div class="meter" style="margin-top:8px"><div id="aProg" style="width:0%"></div></div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="aHelp">–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–≤–µ—Ç—ã</button>
          <button class="btn secondary" id="aMeet">–¢–æ—á–∫–∞ –≤—Å—Ç—Ä–µ—á–∏</button>
        </div>
      </div>
    </div>
  </section>

  <!-- VOLUNTEER -->
  <section id="view-volunteer" class="view hidden">
    <div class="grid">
      <div class="card">
        <h2>–í—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤ (–≤–æ–ª–æ–Ω—Ç—ë—Ä)</h2>
        <p class="muted">–ö–∞–∫ –≤–∏–¥–∏—Ç –≤—ã–∑–æ–≤ –≤–æ–ª–æ–Ω—Ç—ë—Ä: –º–∏–Ω–∏-–∫–∞—Ä—Ç–∞, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, ETA, –æ—Ç–≤–µ—Ç—ã.</p>
        <button class="btn" id="vOpen">–û—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞</button>
      </div>
      <div class="card">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞</h2>
        <div class="row">
          <input id="code" placeholder="–ö–æ–¥-—Å–ª–æ–≤–æ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"/>
          <button class="btn secondary" id="codeOk">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        <div id="codeOut" class="muted" style="margin-top:6px"></div>
      </div>
    </div>
  </section>

  <!-- CROWD -->
  <section id="view-crowd" class="view hidden">
    <div class="grid">
      <div class="card">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–∏—Ö–æ–µ –º–µ—Å—Ç–æ</h2>
        <div class="row">
          <input id="cName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ö–∞—Ñ–µ ¬´–õ–∏–º–æ–Ω¬ª)"/>
          <input id="cAddr" placeholder="–ê–¥—Ä–µ—Å/–æ—Ä–∏–µ–Ω—Ç–∏—Ä (–ê—Å—Ç–∞–Ω–∞)"/>
        </div>
        <div class="row">
          <div class="chip" data-c="music">–ë–µ–∑ –º—É–∑—ã–∫–∏</div>
          <div class="chip" data-c="light">–ú—è–≥–∫–∏–π —Å–≤–µ—Ç</div>
          <div class="chip" data-c="wc">–°–∞–Ω—É–∑–µ–ª</div>
          <div class="chip" data-c="seats">–°–ø–æ–∫–æ–π–Ω—ã–µ –º–µ—Å—Ç–∞</div>
        </div>
        <textarea id="cDesc" placeholder="–ü–æ—á–µ–º—É —Ç–∏—Ö–æ? –ì–¥–µ –ª—É—á—à–µ —Å–∏–¥–µ—Ç—å? –ö–æ–≥–¥–∞ –ª—É—á—à–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å?"></textarea>
        <div class="row"><button class="btn" id="cSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button><button class="btn secondary" id="cClear">–û—á–∏—Å—Ç–∏—Ç—å</button></div>
        <div id="cOut" class="muted" style="margin-top:6px"></div>
      </div>

      <div class="card">
        <h2>–û—Ü–µ–Ω–∏—Ç—å –º–µ—Å—Ç–æ</h2>
        <div class="row"><input id="rPlace" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞"/></div>
        <label>–®—É–º</label><input id="rN" type="range" min="0" max="100" value="15">
        <label>–¢–æ–ª–ø–∞</label><input id="rC" type="range" min="0" max="100" value="20">
        <label>–°–≤–µ—Ç</label><input id="rL" type="range" min="0" max="100" value="10">
        <textarea id="rTxt" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
        <div class="row"><button class="btn" id="rSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button></div>
        <div id="rOut" class="muted" style="margin-top:6px"></div>
      </div>

      <div class="card">
        <h2>–ñ–∞–ª–æ–±–∞ / –≥—Ä–æ–º–∫–∞—è —Ç–æ—á–∫–∞</h2>
        <div class="row"><input id="gWhere" placeholder="–ì–¥–µ? (–¢–†–¶, –≤—Ö–æ–¥ –∏ —Ç. –ø.)"/></div>
        <textarea id="gWhat" placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? (–≥—Ä–æ–º–∫–∞—è –º—É–∑—ã–∫–∞, —è—Ä–∫–∏–µ —ç–∫—Ä–∞–Ω—ã‚Ä¶)"></textarea>
        <div class="row">
          <select id="gType"><option>—à—É–º</option><option>—Ç–æ–ª–ø–∞</option><option>—Å–≤–µ—Ç</option></select>
          <select id="gWhen"><option>—É—Ç—Ä–æ</option><option selected>–¥–µ–Ω—å</option><option>–≤–µ—á–µ—Ä</option><option>–Ω–æ—á—å</option></select>
        </div>
        <button class="btn" id="gSend" style="margin-top:6px">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É</button>
        <div id="gOut" class="muted" style="margin-top:6px"></div>
      </div>

      <div class="card">
        <h2>–õ–µ–Ω—Ç–∞ / –º–æ–¥–µ—Ä–∞—Ü–∏—è</h2>
        <div class="row"><input id="mQ" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª–µ–Ω—Ç–µ"><select id="mSort"><option value="new">–Ω–æ–≤—ã–µ</option><option value="calm">—Å–ø–æ–∫–æ–π–Ω—ã–µ</option><option value="stress">–ø—Ä–æ–±–ª–µ–º–Ω—ã–µ</option></select></div>
        <div id="mFeed" class="grid" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="view-about" class="view hidden">
    <div class="grid">
      <div class="card">
        <h2>–û –ø—Ä–æ–µ–∫—Ç–µ</h2>
        <p>Quiet Routes Astana ‚Äî –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞. –¶–µ–ª—å - —Å–¥–µ–ª–∞—Ç—å –≥–æ—Ä–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –º–µ—Å—Ç–æ–º –¥–ª—è –ª—é–¥–µ–π —Å —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –∞—É—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞, —Å–Ω–∏–∑–∏—Ç—å —Å–µ–Ω—Å–æ—Ä–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –≤ –≥–æ—Ä–æ–¥–µ –∑–∞ —Å—á—ë—Ç —Ç–∏—Ö–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –º–µ—Å—Ç. 
        –ê–≤—Ç–æ—Ä –∏–¥–µ–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞ - –ë–∞—Ä–º–∏–Ω–∞ –ê.–í. –°–≤—è–∑—å - tg@abastassiyabr</p>
      </div>
    </div>
  </section>
</main>

<footer>
  Quiet Routes Astana ¬∑ Ras ¬∑ 2025
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log("JavaScript is running üöÄ");

  // === –î–µ—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º ===
  (function(){
    const els = {
      toggle: document.getElementById('kidModeToggle'),
      method: document.getElementById('notifyMethod'),
      tgToken: document.getElementById('tgToken'),
      tgChat: document.getElementById('tgChat'),
      webhookUrl: document.getElementById('webhookUrl'),
      telegramBlock: document.getElementById('telegramBlock'),
      webhookBlock: document.getElementById('webhookBlock'),
      sendInterval: document.getElementById('sendInterval'),
      btnTest: document.getElementById('btnTest'),
      btnSOS: document.getElementById('btnSOS'),
      status: document.getElementById('kidStatus')
    };

    const dinoRadios = document.querySelectorAll('input[name="dino"]');

    // –º–∞—Ä–∫–µ—Ä –¥–∏–Ω–æ–∑–∞–≤—Ä–∞
    let dinoMarker = document.getElementById('dinoMarker');
    if(!dinoMarker){
      dinoMarker = document.createElement('div');
      dinoMarker.id = 'dinoMarker';
      dinoMarker.className = 'kid-cursor hidden';
      document.body.appendChild(dinoMarker);
    }

    const DINO_SVGS = {
      rex: "<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M8 40h20l6 6 6-6h16v8H8z' fill='%23ff4f8a'/><circle cx='24' cy='28' r='10' fill='%23ff82ab'/><circle cx='28' cy='26' r='2' fill='%23000'/></svg>",
      stego: "<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M6 42h24l4 4 4-4h20v6H6z' fill='%23ff4f8a'/><path d='M12 32l6-6 6 6 6-6 6 6' stroke='%23ff82ab' stroke-width='6' fill='none'/></svg>",
      bronto: "<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><path d='M10 40h22c8 0 10-8 18-8h4v10H10z' fill='%23ff4f8a'/><path d='M40 22c6 0 6 8 6 12' stroke='%23ff82ab' stroke-width='6' fill='none'/></svg>"
    };

    function setDino(kind){
      const svg = DINO_SVGS[kind] || DINO_SVGS.rex;
      dinoMarker.style.backgroundImage = `url("data:image/svg+xml;utf8,${svg}")`;
      dinoMarker.style.backgroundSize = 'contain';
      dinoMarker.style.backgroundRepeat = 'no-repeat';
    }

    function updateMethodBlocks(){
      const m = els.method.value;
      els.telegramBlock.classList.toggle('hidden', m !== 'telegram');
      els.webhookBlock.classList.toggle('hidden', m !== 'webhook');
    }

    // –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    const saved = JSON.parse(localStorage.getItem('kid_opts') || '{}');
    if(els.toggle) els.toggle.checked = !!saved.enabled;
    if(els.method) els.method.value = saved.method || 'telegram';
    if(els.tgToken) els.tgToken.value = saved.tgToken || '';
    if(els.tgChat) els.tgChat.value = saved.tgChat || '';
    if(els.webhookUrl) els.webhookUrl.value = saved.webhookUrl || '';
    if(els.sendInterval) els.sendInterval.value = saved.interval || 60;

    if(dinoRadios.length){
      const toCheck = [...dinoRadios].find(r=>r.value === (saved.dino||'rex')) || dinoRadios[0];
      toCheck.checked = true;
    }
    setDino(saved.dino || 'rex');
    updateMethodBlocks();

    function save(){
      const chosenDino = [...dinoRadios].find(r=>r.checked)?.value || 'rex';
      const opts = {
        enabled: els.toggle?.checked,
        method: els.method?.value,
        tgToken: els.tgToken?.value.trim(),
        tgChat: els.tgChat?.value.trim(),
        webhookUrl: els.webhookUrl?.value.trim(),
        interval: Math.max(10, parseInt(els.sendInterval?.value||60,10)),
        dino: chosenDino
      };
      localStorage.setItem('kid_opts', JSON.stringify(opts));
      setDino(opts.dino);
      return opts;
    }

    dinoRadios.forEach(r=>r.addEventListener('change', save));
    ['change','input'].forEach(ev=>{
      els.toggle?.addEventListener(ev, onToggle);
      els.method?.addEventListener(ev, ()=>{ save(); updateMethodBlocks(); });
      els.tgToken?.addEventListener(ev, save);
      els.tgChat?.addEventListener(ev, save);
      els.webhookUrl?.addEventListener(ev, save);
      els.sendInterval?.addEventListener(ev, save);
    });

    // –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
    let watchId = null;
    let lastSent = 0;
    let lastPos = null;

    async function notifyParent(kind, coords, extra){
      const opts = JSON.parse(localStorage.getItem('kid_opts') || '{}');
      const ts = new Date().toISOString();
      const text = kind === 'SOS'
        ? `üö® SOS!\n–í—Ä–µ–º—è: ${ts}\n–®–∏—Ä–æ—Ç–∞: ${coords?.latitude}\n–î–æ–ª–≥–æ—Ç–∞: ${coords?.longitude}\n–°–∫–æ—Ä–æ—Å—Ç—å: ${coords?.speed||'‚Äî'}`
        : `üìç –û—Ç—á—ë—Ç –¥–≤–∏–∂–µ–Ω–∏—è\n–í—Ä–µ–º—è: ${ts}\n–®–∏—Ä–æ—Ç–∞: ${coords?.latitude}\n–î–æ–ª–≥–æ—Ç–∞: ${coords?.longitude}\n–°–∫–æ—Ä–æ—Å—Ç—å: ${coords?.speed||'‚Äî'}`;

      try{
        if(opts.method === 'telegram' && opts.tgToken && opts.tgChat){
          const url = `https://api.telegram.org/bot${opts.tgToken}/sendMessage`;
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: opts.tgChat, text })
          });
        } else if(opts.method === 'webhook' && opts.webhookUrl){
          await fetch(opts.webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: kind, timestamp: ts, coords, extra })
          });
        }
      } catch(e){
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', e);
      }
    }

    function onToggle(){
      const opts = save();
      if(opts.enabled){
        startTracking();
        els.status && (els.status.textContent = '–≤–∫–ª—é—á–µ–Ω–æ');
        dinoMarker.classList.remove('hidden');
      }else{
        stopTracking();
        els.status && (els.status.textContent = '–≤—ã–∫–ª—é—á–µ–Ω–æ');
        dinoMarker.classList.add('hidden');
      }
    }

    function startTracking(){
      if(!('geolocation' in navigator)){
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
        if(els.toggle) els.toggle.checked = false;
        save();
        return;
      }
      if(watchId !== null) return;
      watchId = navigator.geolocation.watchPosition(async (pos)=>{
        const { latitude, longitude, speed, accuracy } = pos.coords;
        lastPos = { latitude, longitude, speed, accuracy };
        // –ø–æ–∑–∏—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞-–¥–∏–Ω–æ–∑–∞–≤—Ä–∞ (–¥–ª—è –¥–µ–º–æ ‚Äî —Ü–µ–Ω—Ç—Ä)
        dinoMarker.style.left = '50%';
        dinoMarker.style.top = '50%';

        const now = Date.now();
        const interval = Math.max(10, parseInt(els.sendInterval?.value||60,10))*1000;
        if(now - lastSent >= interval){
          lastSent = now;
          notifyParent('TICK', lastPos);
        }
      }, (err)=>{
        console.warn('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—à–∏–±–∫–∞', err);
      }, {
        enableHighAccuracy: true,
        maximumAge: 5000,
        timeout: 15000
      });
    }

    function stopTracking(){
      if(watchId !== null){
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
      }
    }

    els.btnTest?.addEventListener('click', ()=>{
      notifyParent('TEST', lastPos || {latitude:null, longitude:null}, { note: 'probe' });
    });
    els.btnSOS?.addEventListener('click', ()=>{
      if(lastPos){
        notifyParent('SOS', lastPos);
      } else {
        navigator.geolocation.getCurrentPosition((pos)=>{
          const { latitude, longitude, speed, accuracy } = pos.coords;
          notifyParent('SOS', {latitude, longitude, speed, accuracy});
        }, ()=>notifyParent('SOS', {latitude:null, longitude:null}));
      }
    });

    if(els.toggle?.checked){ onToggle(); }
  })();

  // ---- Router ----
  const routes = ["home","routes","places","planner","alarm","volunteer","crowd","about","kids"];
  function setActive(view){
    document.querySelectorAll('nav a').forEach(a=>a.classList.toggle('active', a.dataset.view===view));
  }
  function show(view){
    routes.forEach(v=>{
      const section = document.getElementById('view-'+v);
      if(section) section.classList.add('hidden');
    });
    const activeView = document.getElementById('view-'+view);
    if(activeView) activeView.classList.remove('hidden');
    setActive(view);
    try{ localStorage.setItem('qr_last_view', view); }catch(e){}
  }
  function parseRoute(){
    const raw = location.hash || '#/';
    const m = raw.match(/^#\/?([^?]*)/);
    const segment = (m && m[1]) ? m[1] : '';
    const v = routes.includes(segment) ? segment : 'home';
    show(v);
  }
  window.addEventListener('hashchange', parseRoute);
  parseRoute();
  const lastView = localStorage.getItem('qr_last_view');
  if(lastView) show(lastView);

  // ---- Quiet theme ----
  const toggleBtn = document.getElementById('toggleQuiet');
  toggleBtn?.addEventListener('click', ()=> document.body.classList.toggle('quiet-theme'));

  // ---- Routes logic (demo) ----
  const chipsRoute = Array.from(document.querySelectorAll('#view-routes .chip'));
  chipsRoute.forEach(ch => ch.addEventListener('click', ()=> ch.classList.toggle('active')));

  function currentProfile(){
    const on = chipsRoute.filter(c=>c.classList.contains('active')).map(c=>c.dataset.k);
    return { noise:on.includes('noise'), crowd:on.includes('crowd'), light:on.includes('light'), cross:on.includes('cross'),
             parks:on.includes('parks'), yards:on.includes('yards'), paths:on.includes('paths') };
  }
  function timeBucket(){
    const h = new Date().getHours();
    if(h>=6 && h<10) return '—É—Ç—Ä–æ';
    if(h>=10 && h<16) return '–¥–µ–Ω—å';
    if(h>=16 && h<20) return '–≤–µ—á–µ—Ä';
    return '–Ω–æ—á—å';
  }
  function buildQuiet(){
    const pr = currentProfile(); const bucket = timeBucket();
    let w = { park:1.0, yard:1.1, foot:1.2, street:1.6, big:2.1, screens:2.4 };
    if(pr.noise){ w.street+=0.3; w.big+=0.5; }
    if(pr.crowd){ w.street+=0.3; w.big+=0.4; }
    if(pr.light){ w.screens+=0.6; }
    if(pr.cross){ w.big+=0.6; }
    if(pr.parks) w.park-=0.2; if(pr.yards) w.yard-=0.1; if(pr.paths) w.foot-=0.1;
    if(bucket==='–≤–µ—á–µ—Ä'){ w.street+=0.2; } if(bucket==='—É—Ç—Ä–æ'){ w.park-=0.1; }

    const seg1 = document.getElementById('seg1');
    const seg2 = document.getElementById('seg2');
    const segBad = document.getElementById('segBad');

    if(seg1) seg1.setAttribute('stroke-dasharray', w.park+w.yard < 2.3 ? '' : '6 6');
    if(seg2) seg2.setAttribute('stroke-dasharray', w.foot < 1.25 ? '' : '6 6');
    if(segBad) segBad.setAttribute('stroke', (w.street+w.big>3.6) ? '#e03b5a88' : '#e0a75a88');

    const steps = document.getElementById('steps');
    if(steps){
      steps.innerHTML = `
        <div class="card"><strong>–ß–µ—Ä–µ–∑ –¥–≤–æ—Ä/–≤–¥–æ–ª—å –¥–æ–º–æ–≤</strong><div class="muted">–≤–µ—Å ${(w.yard).toFixed(1)}</div></div>
        <div class="card"><strong>–¢—Ä–æ–ø–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∫</strong><div class="muted">${bucket}, –æ–∂–∏–¥–∞–Ω–∏–µ –ª—é–¥–µ–π ‚Äî –Ω–∏–∑–∫–æ–µ ¬∑ –≤–µ—Å ${(w.park).toFixed(1)}</div></div>
        <div class="card"><strong>–ù–µ–±–æ–ª—å—à–∞—è —É–ª–∏—Ü–∞</strong><div class="muted">–º–∏–Ω–∏–º—É–º –≤–∏—Ç—Ä–∏–Ω ¬∑ –≤–µ—Å ${(w.street).toFixed(1)}</div></div>`;
    }
  }
  document.getElementById('build')?.addEventListener('click', buildQuiet);
  document.getElementById('alt')?.addEventListener('click', ()=>{
    const seg2 = document.getElementById('seg2');
    if(seg2) seg2.setAttribute('stroke-dasharray','8 8');
    alert('–ü–æ–∫–∞–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–¥–µ–º–æ)');
  });
  document.getElementById('exportRoute')?.addEventListener('click', ()=>{
    const txt = '–ú–∞—Ä—à—Ä—É—Ç A‚ÜíB (—Ç–∏—Ö–∏–π): –¥–≤–æ—Ä ‚Üí –ø–∞—Ä–∫ ‚Üí –º–∞–ª–∞—è —É–ª–∏—Ü–∞. –ù–∞—Å—Ç—Ä–æ–π–∫–∏: '+JSON.stringify(currentProfile());
    const blob = new Blob([txt], {type:'text/plain'});
    const url=URL.createObjectURL(blob);
    const a = Object.assign(document.createElement('a'), {href:url, download:'quiet_route.txt'});
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  document.getElementById('startNav')?.addEventListener('click', ()=>{
    location.hash = '#/alarm';
    alert('–î–µ–º–æ: –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞, –≤ ¬´–¢—Ä–µ–≤–æ–≥–µ¬ª –º–æ–∂–Ω–æ –ø–æ–∑–≤–∞—Ç—å –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞.');
  });

  // ---- Places (mock POI) ----
  const poi=[{name:'–ë”ô–π—Ç–µ—Ä–µ–∫',addr:'–ø–ª. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏',tags:['park'],open:true,stress:0.12,x:420,y:120},
             {name:'–ë–æ—Ç–∞–Ω–∏—á–µ—Å–∫–∏–π —Å–∞–¥',addr:'—É–ª. –¢—É—Ä–∫–µ—Å—Ç–∞–Ω',tags:['park','light'],open:true,stress:0.08,x:520,y:180},
             {name:'–•–∞–Ω –®–∞—Ç—ã—Ä (—Ç–∏—Ö–∞—è –∑–æ–Ω–∞)',addr:'–ø—Ä–æ—Å–ø. –¢—É—Ä–∞–Ω',tags:['music','light'],open:true,stress:0.20,x:350,y:110},
             {name:'Mega Silk Way (—Ç–∏—Ö–∞—è –∑–æ–Ω–∞)',addr:'EXPO',tags:['light'],open:true,stress:0.22,x:560,y:150},
             {name:'–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –ï—Å–∏–ª—è',addr:'–ª–µ–≤—ã–π –±–µ—Ä–µ–≥',tags:['park'],open:true,stress:0.10,x:250,y:210},
             {name:'–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Ññ3',addr:'–°–∞—Ä—ã–∞—Ä–∫–∞',tags:['music'],open:true,stress:0.09,x:180,y:220},
             {name:'–ö–µ—Ä—É–µ–Ω (–∫–∞—Ñ–µ –±–µ–∑ –º—É–∑—ã–∫–∏)',addr:'–ø—Ä–æ—Å–ø. –î–æ—Å—Ç—ã–∫',tags:['music','light'],open:true,stress:0.18,x:400,y:150}];

  const placeChips=[...document.querySelectorAll('#view-places .chip')];
  placeChips.forEach(c=>c.addEventListener('click',()=>{c.classList.toggle('active'); renderPlaces();}));

  function renderPlaces(){
    const on=placeChips.filter(c=>c.classList.contains('active')).map(c=>c.dataset.f);
    const list=poi.filter(p=>(on.includes('open')?p.open:true)
      &&(!on.includes('music')||p.tags.includes('music'))
      &&(!on.includes('light')||p.tags.includes('light'))
      &&(!on.includes('wc')||p.tags.includes('wc'))).sort((a,b)=>a.stress-b.stress);

    const box=document.getElementById('placeList'); if(box){ box.innerHTML=''; }
    list.forEach(p=>{
      const el=document.createElement('div'); el.className='card';
      const label=p.stress<0.15?'–æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π':(p.stress<0.3?'–Ω–∏–∑–∫–∏–π':'—Å—Ä–µ–¥–Ω–∏–π');
      el.innerHTML=`<strong>${p.name}</strong><div class="muted">${p.addr}</div>
        <div style="margin-top:6px" class="pill"><span class="dot"></span> —Å—Ç—Ä–µ—Å—Å: ${(p.stress*100|0)} ¬∑ ${label}</div>
        <div class="row" style="margin-top:8px">
          <a class="btn" href="#/routes">–ò–¥—Ç–∏ —Å—é–¥–∞</a>
          <a class="btn secondary" href="#/crowd">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
        </div>`;
      if(box) box.appendChild(el);
    });
    const mk=document.getElementById('poiLayer'); if(mk){ mk.innerHTML='';
      list.forEach(p=>{const c=document.createElementNS('http://www.w3.org/2000/svg','circle'); c.setAttribute('cx',p.x); c.setAttribute('cy',p.y); c.setAttribute('r',6); c.setAttribute('fill','#18a999'); c.setAttribute('stroke','#fff'); c.setAttribute('stroke-width','2'); mk.appendChild(c);});
    }
  }
  renderPlaces();

  // ---- Planner ----
  const pd=document.getElementById('pDate'); if(pd) pd.value=new Date().toISOString().split('T')[0];

  document.getElementById('pSuggest')?.addEventListener('click', ()=>{
    const d = new Date(document.getElementById('pDate').value);
    const wd=[0,6].includes(d.getDay());
    const win=wd?'09:00‚Äì11:00':'10:30‚Äì12:00 –∏–ª–∏ 14:30‚Äì16:30';
    document.getElementById('pOut').textContent='–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ —Ç–∏—Ö–æ–µ –æ–∫–Ω–æ: '+win+'.';
  });
  document.getElementById('pSave')?.addEventListener('click', ()=>{
    const rec={date:document.getElementById('pDate').value,time:document.getElementById('pTime').value,A:document.getElementById('pA').value,B:document.getElementById('pB').value};
    try{ localStorage.setItem('qr_plan', JSON.stringify(rec)); }catch(e){}
    document.getElementById('pOut').textContent='–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: '+rec.date+' '+rec.time+' ¬∑ '+rec.A+' ‚Üí '+rec.B;
  });
  document.getElementById('pExport')?.addEventListener('click', ()=>{
    const txt=document.getElementById('pOut').textContent||'–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç';
    const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(new Blob([txt],{type:'text/plain'})),download:'plan.txt'});
    document.body.appendChild(a); a.click(); a.remove();
  });

  // ---- Alarm & Volunteer ----
  document.getElementById('aSend')?.addEventListener('click', ()=>{
    const st=document.getElementById('aStatus'); if(st) st.textContent='–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –í–æ–ª–æ–Ω—Ç—ë—Ä –≤ –ø—É—Ç–∏.';
    const p=document.getElementById('aProg'); let w=0; const t=setInterval(()=>{ w=Math.min(100,w+10); if(p) p.style.width=w+'%'; if(w===100) clearInterval(t); },700);
  });
  document.getElementById('aShare')?.addEventListener('click', ()=>{ const st=document.getElementById('aStatus'); if(st) st.textContent='–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É.'; });
  document.getElementById('aHelp')?.addEventListener('click', ()=>alert('–°–æ–≤–µ—Ç—ã: –æ—Ç–æ–π—Ç–∏ –æ—Ç –¥–æ—Ä–æ–≥–∏/—ç–∫—Ä–∞–Ω–∞, –Ω–∞—É—à–Ω–∏–∫–∏/–±–µ—Ä—É—à–∏, –¥—ã—Ö–∞–Ω–∏–µ 4-4-6.'));
  document.getElementById['aMeet']?.addEventListener?.('click', ()=>alert('–¢–æ—á–∫–∞ –≤—Å—Ç—Ä–µ—á–∏: —É –≤—Ö–æ–¥–∞ ‚Ññ2.'));

  document.getElementById('vOpen')?.addEventListener('click', ()=>alert('–≠–∫—Ä–∞–Ω –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞ –æ—Ç–∫—Ä—ã—Ç (–¥–µ–º–æ).'));
  document.getElementById('codeOk')?.addEventListener('click', ()=>{
    const ok=(document.getElementById('code').value||'').trim().length>=4;
    document.getElementById('codeOut').textContent=ok?'–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω. –í–æ–ª–æ–Ω—Ç—ë—Ä –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.':'–ö–æ–¥ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π.';
  });

  // ---- Crowd ----
  function getLS(k){ try{return JSON.parse(localStorage.getItem(k)||'[]')}catch(e){return[]} }
  function setLS(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} }
  document.getElementById('cSend')?.addEventListener('click', ()=>{
    const n=(document.getElementById('cName').value||'').trim(), a=(document.getElementById('cAddr').value||'').trim();
    if(!n||!a){ alert('–£–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–¥—Ä–µ—Å'); return; }
    const cats=[...document.querySelectorAll('[data-c].active')].map(x=>x.textContent);
    const desc=(document.getElementById('cDesc').value||'').trim();
    const items=getLS('qr_places'); items.unshift({name:n,addr:a,cats,desc,ts:Date.now(),stress:0.2,status:'pending'}); setLS('qr_places',items);
    const out=document.getElementById('cOut'); if(out) out.textContent='–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é.'; renderFeed();
  });
  document.getElementById('cClear')?.addEventListener('click', ()=>{
    ['cName','cAddr','cDesc'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';});
    document.querySelectorAll('[data-c].active').forEach(x=>x.classList.remove('active'));
    const out=document.getElementById('cOut'); if(out) out.textContent='';
  });
  document.querySelectorAll('[data-c]').forEach(ch=>ch.addEventListener('click', ()=>ch.classList.toggle('active')));

  document.getElementById('rSend')?.addEventListener('click', ()=>{
    const place=(document.getElementById('rPlace').value||'').trim(); if(!place){ alert('–£–∫–∞–∂–∏ –º–µ—Å—Ç–æ'); return; }
    const n=+document.getElementById('rN').value, c=+document.getElementById('rC').value, l=+document.getElementById('rL').value, txt=(document.getElementById('rTxt').value||'').trim();
    const items=getLS('qr_rates'); items.unshift({place,n,c,l,txt,ts:Date.now()}); setLS('qr_rates',items);
    const out=document.getElementById('rOut'); if(out) out.textContent='–°–ø–∞—Å–∏–±–æ! –û—Ü–µ–Ω–∫–∞ —É—á—Ç–µ–Ω–∞.'; renderFeed();
  });

  document.getElementById('gSend')?.addEventListener('click', ()=>{
    const where=(document.getElementById('gWhere').value||'').trim();
    const what=(document.getElementById('gWhat').value||'').trim();
    if(!where||!what){ alert('–ó–∞–ø–æ–ª–Ω–∏ –∞–¥—Ä–µ—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ'); return; }
    const type=document.getElementById('gType').value, when=document.getElementById('gWhen').value;
    const items=getLS('qr_issues'); items.unshift({where,what,type,when,ts:Date.now(),status:'pending'}); setLS('qr_issues',items);
    const out=document.getElementById('gOut'); if(out) out.textContent='–°–ø–∞—Å–∏–±–æ! –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.'; renderFeed();
  });

  function seed(){
    if(!localStorage.getItem('qr_seeded')){
      setLS('qr_feed', [
        {name:'–ö–∞—Ñ–µ ¬´–õ–∏–º–æ–Ω¬ª',desc:'–±–µ–∑ –º—É–∑—ã–∫–∏, –º—è–≥–∫–∏–π —Å–≤–µ—Ç',stress:0.15,status:'approved'},
        {name:'–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Ññ3',desc:'—á–∏—Ç–∞–ª—å–Ω—ã–π –∑–∞–ª',stress:0.08,status:'approved'},
        {name:'–ü–∞—Ä–∫ —É –æ–∑–µ—Ä–∞',desc:'–ø—Ä–æ—Å—Ç–æ—Ä–Ω–æ —É—Ç—Ä–æ–º',stress:0.10,status:'pending'},
        {name:'–ö–æ—Ñ–µ–π–Ω—è ¬´–°–æ–≤–∞¬ª',desc:'—à—É–º–Ω–æ –≤–µ—á–µ—Ä–æ–º —É –±–∞—Ä–∞',stress:0.55,status:'flagged'}
      ]);
      localStorage.setItem('qr_seeded','1');
    }
  }
  function renderFeed(){
    seed();
    let feed=getLS('qr_feed');
    const added=getLS('qr_places').map(x=>({name:x.name,desc:(x.desc||x.addr),stress:x.stress,status:x.status}));
    const issues=getLS('qr_issues').map(x=>({name:x.where,desc:x.what,stress:0.6,status:'flagged'}));
    feed=[...added,...issues,...feed];
    const q=(document.getElementById('mQ')?.value||'').toLowerCase();
    const sort=document.getElementById('mSort')?.value||'new';
    let list=feed.filter(x=>(x.name+x.desc).toLowerCase().includes(q));
    if(sort==='calm') list.sort((a,b)=>a.stress-b.stress);
    if(sort==='stress') list.sort((a,b)=>b.stress-a.stress);
    const box=document.getElementById('mFeed'); if(!box) return; box.innerHTML='';
    list.forEach(i=>{
      const s=i.status==='approved'?'–æ–¥–æ–±—Ä–µ–Ω–æ':(i.status==='flagged'?'–ø—Ä–æ–±–ª–µ–º–∞':'–æ–∂–∏–¥–∞–µ—Ç');
      const div=document.createElement('div'); div.className='card';
      div.innerHTML=`<div class="row" style="justify-content:space-between;align-items:center">
        <div><strong>${i.name}</strong><div class="muted">${i.desc}</div></div>
        <span class="pill"><span class="dot"></span> ${s} ¬∑ —Å—Ç—Ä–µ—Å—Å ${(i.stress*100|0)}</span>
      </div>
      <div class="row" style="margin-top:8px"><button class="btn secondary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button><button class="btn">–û–¥–æ–±—Ä–∏—Ç—å</button><button class="btn">–°–∫—Ä—ã—Ç—å</button></div>`;
      box.appendChild(div);
    });
  }
  renderFeed();
});
</script>

</body>
</html>
